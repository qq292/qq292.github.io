<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="source/css/all.css">
    <link rel="stylesheet" href="source/css/prism.css" />
    <script src="source/js/prism.js"></script>
    <title>Behavior Designer(中文)</title>

</head>
<style>
    * {
        padding: 0px;
        margin: 0px;
        box-sizing: border-box;
    }

   
    .scroll::-webkit-scrollbar {
        width: 2px;
    }

    .scroll::-webkit-scrollbar-thumb {
        background-image: var(--linear-001);
        border-radius: 5px;

    }

    :root {
        --tool-height: 40px;
        --h1-height: 42px;
        --catalog-width: 340px;
        --anim-catalog-width: calc(-1 * var(--catalog-width));
        --linear-001: linear-gradient(45deg, white 0%, deeppink 40%, skyblue 60%, white 100%);
        font-size: medium;
        --green-01: #3da33d;

    }

    ul {
        list-style: none;
        width: 100%;
    }



    .red {
        background-color: red;
    }

    .green {
        background-color: green;
    }

    .pink {
        background-color: pink;
    }

    .gray {
        background-color: gray;
    }

    .scroll {
        overflow-y: auto;
        overflow-x: hidden;
    }

    body {
        height: auto;
    }

    .container {
        width: 100%;
        height: calc(100vh - var(--tool-height));
        display: flex;
        flex-wrap: wrap;


    }

    .catalog li a {
        display: inline-block;
        text-decoration: none;
        color: black;
        width: 100%;
        height: 100%;
        padding: 10px 10px 10px 40px;
        font-size: small;

    }

    .catalog li:hover a {
        color: var(--green-01);
    }

    .catalog li:hover {
        background-color: #20252329;

    }

    .catalog ul {
        padding: 10px 8px;
    }

    .catalog li {
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        text-align: left;

    }

    .content h1 {
        line-height: var(--h1-height);
        padding: 10px 0px;
        top: 0px;
        background-color: white;
    }

    .content p {
        white-space: pre-line;

        padding-bottom: 3rem;
    }


    .content img {
        padding: 20px 0px;
    }

    

    .content-box {
        display: flex;
        width: 100%;
        height: 100%;
        position: relative;
        background-color: #e6e6e6;

    }

    .active a {
        color: var(--green-01) !important;
    }

    .catalog {
        background-color: white;
        height: 100%;
        width: var(--catalog-width);
        display: flex;
        justify-content: center;
        border-right: 1px solid gray;
        position: absolute;
        top: 0;
        z-index: 1000;
    }

    .scroll-smooth {
        scroll-behavior: smooth;
    }

    .content-article {
        display: flex;
        justify-content: center;
        width: 100%;
        height: 100%;

    }

    .content {
        background-color: white;
        height: 100%;
        width: 50%;
        display: flex;
        flex-direction: column;
        padding: 0px 3.2rem;
        box-shadow: 0 0 2px gray;
        font-size: medium;
        line-height: 1.8rem;

    }

    .content ul {
        list-style: inside;
    }

    .content li {
        /* line-height: 1em; */
        padding-left: 10px;
        padding-top: 4px;
        padding-bottom: 4px;
        display: inline-block;

    }

    img {
        max-width: 100%;
        /* 图片的最大宽度为父容器的100% */
        height: auto;
        /* 高度根据宽度自动缩放，保持宽高比 */
    }

    .hide {
        display: none;
    }



    .toolBar {
        display: flex;
        width: 100%;
        height: var(--tool-height);
        border-bottom: 1px solid gray;
        /* position: sticky; */
        top: 0px;
        bottom: 100%;
        background-color: transparent;
        padding: 0px 10px;
        background-color: #f7f7f7;
        z-index: 1000;

    }

    .toolBar-left,
    .toolBar-right,
    .toolBar-center {
        display: flex;
        align-items: center;
        width: 100%;
        height: 100%;
    }

    .anim-catalog-to,
    .anim-catalog-back {
        animation-duration: 0.15s;
        animation-fill-mode: forwards;
        animation-name: catalog-to;
    }

    .anim-catalog-back {
        animation-direction: reverse;
    }

    #menu {
        cursor: pointer;
        padding: 0.4rem;
        border-radius: 10%;
    }

    #menu:hover {
        background-color: rgba(111, 111, 111, 0.24);
    }

    @keyframes catalog-to {
        0% {
            transform: translateX(0px);
        }

        100% {
            transform: translateX(var(--anim-catalog-width));
        }
    }

    .toolBar-right-group1 {
        width: 100%;
        display: flex;
        justify-content: flex-end;
    }

    #lang-select {
        display: flex;
        outline: none;
        height: 1.5rem;
        padding: 0px 6px;
        border-radius: 6px;

    }

    #lang-select:hover {
        background-image: var(--linear-001);
        color: transparent;
        background-clip: text;
    }

    @media (max-width: 2400px) {
        .content {
            height: 100%;
            width: 50%;
            padding: 0px 3.2rem;
        }

    }

    @media (max-width: 1199px) {
        .content {
            height: 100%;
            width: 80%;
            padding: 0px 2.2rem;
        }

    }

    @media(max-width: 575px) {
        .content {
            height: 100%;
            width: 100%;
            padding: 0px 1.2rem;
        }

        .catalog {
            width: 100%;
        }

        @keyframes catalog-to {
            0% {
                transform: translateX(0%);
            }

            100% {
                transform: translateX(-100%);
            }
        }
    }
</style>

<body>
    <div id="error404"
        style="display: none;position:fixed;width: 100vw;height: 100vh;background-color: azure;justify-content: center;align-items: center;top:0px;left: 0px;z-index: 999999;">
        <p style="font-size: 2.2rem;">找不到页面！</p>
    </div>
    <div class="toolBar">
        <div class="toolBar-left ">
            <i id="menu" class="fa fa-align-right" style="font-size:1.15rem;"></i>
        </div>
        <div class="toolBar-center ">
            <!-- <button>setting</button> -->
        </div>
        <div class="toolBar-right ">
            <div class="toolBar-right-group1">
                <select name="select" id="lang-select">
                    <option value="中文">中文</option>
                    <option value="英语">英语</option>
                    <option value="日语">日语</option>
                </select>
            </div>
        </div>

    </div>
    <div class="container ">


        <div class="content-box">
            <div class="catalog scroll">
                <ul>
                </ul>
            </div>
            <div class="content-article">
                <div class="content scroll ">

                </div>
            </div>
        </div>
    </div>
</body>
<script>
    const datas = [
        
    ]
</script>
<script>

    function __to_json() {
        console.log(JSON.stringify(datas))
    }

    // __to_json()



    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }




    var error404 = document.querySelector("#error404")
    var catalog_ul = document.querySelector(".catalog ul")
    var catalog = document.querySelector(".catalog")
    var content = document.querySelector(".content")
    var btn_menu = document.querySelector("#menu")

    function playCatalogAnimation(animName) {
        catalog.classList.remove("anim-catalog-to", "anim-catalog-back")
        void catalog.offsetWidth;
        catalog.classList.add("anim-catalog-" + animName)
    }


    btn_menu.addEventListener("click", () => {
        if (catalog.classList.contains("anim-catalog-to")) {
            playCatalogAnimation("back")
        } else {
            catalog.classList.remove("anim-catalog-to", "anim-catalog-back")
            void catalog.offsetWidth;
            playCatalogAnimation("to")
        }
    })



    function getAnchoor() {
        return document.querySelectorAll("*[id^='anchor']")
    }

    //目录项目点击事件
    function catalogItemClicked() {

        if (window.matchMedia('(max-width: 1350px)').matches || isMobileDevice()) {
            playCatalogAnimation("to")

        }

    }

    //生成目录
    function generateLeftCatalog(anchors) {
        let toc = []
        for (let anchor of anchors) {
            let li = document.createElement("li")
            let a = document.createElement("a")
            a.textContent = anchor.dataset.anchorTitle
            a.href = "#" + anchor.id
            li.appendChild(a)

            li.onclick = catalogItemClicked
            toc.push(li)
            catalog_ul.appendChild(li)

        }
        return toc
    }

    //生成内容
    function generateContent(datas) {
        let anchors = []
        for (let [i, data] of datas.entries()) {
            let p = document.createElement("p")
            let h1 = document.createElement("h1")
            let span = document.createElement("span")
            anchors.push(span)
            span.setAttribute("data-anchor-title", data.title)
            span.id = "anchor" + i
            h1.textContent = data.title
            p.innerHTML = data.content
            content.appendChild(span)
            content.appendChild(h1)
            content.appendChild(p)
        }
        //移动端不显示代码行号
        if (isMobileDevice()) {
            for (let code of document.querySelectorAll(".content code")) {
                code.classList.remove("line-numbers")
            }

        }

        return anchors

    }
    function getParameterByName(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }
    function readData(callBack) {
        if (window.location.protocol === "file:") {
            callBack(datas)
            return
        }

        let articleName = getParameterByName('n')
        if (!articleName) { error404.style.display = 'flex'; return }
        // BehaviorTreeDocument
        fetch(`data/${articleName}.json`) // 'data.json' 是 JSON 文件相对于 index.html 的路径
            .then(response => response.json())
            .then(data => {
                callBack(data);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    }
    function saveScrollPosition(value) {
        window.localStorage.setItem("scrollPosition", value)
    }
    function initialScrollPosition() {
        let position = window.localStorage.getItem("scrollPosition")
        if (position) {
            content.scrollTo(0,position)
        }else{
            highlightTocItem();
        }
    }
    //该函数由ai生成
    function highlightTocItem() {
        let currentSection = null;
        let currentSectionId = null;
        saveScrollPosition(content.scrollTop)
        anchors.forEach(section => {
            const sectionTop = section.offsetTop; // 元素距离文档顶部的距离
            const scrollPosition = content.scrollTop;
            // 检查 section 是否在视窗内（或接近视窗顶部）
            if (scrollPosition >= sectionTop - window.innerHeight) {  // 调整innerHeight/3 可以控制高亮切换的灵敏度
                currentSection = section;
                currentSectionId = section.id;
            }
        });
        // 如果找到了当前 section，则更新高亮
        if (currentSectionId) {
            toc.forEach(link => {
                link.classList.remove('active'); // 移除所有链接的 active 类
                if (link.querySelector('a').getAttribute("href") === "#" + currentSectionId) {
                    link.classList.add('active'); // 为当前链接添加 active 类   
                }
            });
        }
    }

    var anchors, toc
    readData((data) => {
        anchors = generateContent(data)
        toc = generateLeftCatalog(anchors)
        content.addEventListener('scroll', highlightTocItem);
        Prism.highlightAll()
        
        initialScrollPosition()


    })



</script>

</html>
